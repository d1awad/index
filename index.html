<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>استمارة مسح بطاقة الهوية</title>
  <script src="https://unpkg.com/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
</head>
<body>
  <form id="idForm">
    <label for="idUpload">رفع صورة البطاقة:</label>
    <input type="file" id="idUpload" accept="image/*" capture="camera">
    <button type="submit">إرسال</button>
  </form>
  <div id="result">
    <label>الاسم:</label><input type="text" id="nameField"><br>
    <label>رقم الهوية:</label><input type="text" id="idNumberField"><br>
    <label>تاريخ الميلاد:</label><input type="text" id="dobField">
  </div>

  <script>
    document.getElementById('idForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const fileInput = document.getElementById('idUpload');
      const file = fileInput.files[0];
      if (file) {
        const { createWorker } = Tesseract;
        const worker = await createWorker('ara'); // دعم اللغة العربية
        await worker.setParameters({
          tessedit_char_whitelist: 'ابتثجحخدذرزسشصضطظعغفقكلمنهوي1234567890' // أحرف عربية وأرقام
        });
        const { data: { text } } = await worker.recognize(file);
        await worker.terminate();

        // استخراج البيانات باستخدام تعبيرات منتظمة
        const nameMatch = text.match(/الاسم[\s\S]*?([\u0600-\u06FF\s]+)/); // استخراج الاسم
        const idMatch = text.match(/رقم الهوية[\s\S]*?(\d+)/); // استخراج رقم الهوية
        const dobMatch = text.match(/تاريخ الميلاد[\s\S]*?(\d{2}\/\d{2}\/\d{4})/); // استخراج تاريخ الميلاد

        // تعبئة الحقول
        document.getElementById('nameField').value = nameMatch ? nameMatch[1].trim() : '';
        document.getElementById('idNumberField').value = idMatch ? idMatch[1] : '';
        document.getElementById('dobField').value = dobMatch ? dobMatch[1] : '';
      }
    });
  </script>
</body>
</html>
