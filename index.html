<script>
  const video = document.getElementById("video");

  async function startCamera() {
    const devices = await navigator.mediaDevices.enumerateDevices();
    const videoDevices = devices.filter(device => device.kind === 'videoinput');

    let backCamera = videoDevices.find(device => /back|rear|environment/gi.test(device.label));
    if (!backCamera) backCamera = videoDevices[0];

    const constraints = {
      video: {
        deviceId: backCamera.deviceId ? { exact: backCamera.deviceId } : undefined
      }
    };

    const stream = await navigator.mediaDevices.getUserMedia(constraints);
    video.srcObject = stream;

    setTimeout(() => captureAndRead(stream), 3000);
  }

  function captureAndRead(stream) {
    const canvas = document.getElementById("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext("2d").drawImage(video, 0, 0);

    Tesseract.recognize(canvas, 'eng').then(({ data: { text } }) => {
      const idMatch = text.match(/\d{6,}/);
      if (idMatch) {
        document.getElementById("idField").value = idMatch[0];
      } else {
        alert("No ID number found.");
      }
      stream.getTracks().forEach(track => track.stop());
    });
  }
</script>
